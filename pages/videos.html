<div style="padding: 0; width: 100%;">
    <!-- ЗАГОЛОВОК -->
    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 30px;">
        <div>
            <h1 style="font-size: 32px; font-weight: 800; margin-bottom: 8px;">Видеоклипы</h1>
            <p style="color: #7a7a7a; font-size: 15px;">Смотри лучшие клипы в высоком качестве</p>
        </div>
        <div style="display: flex; gap: 12px;">
            <div class="p-btn" style="width: 45px; height: 45px; background: #1a1a1a;" onclick="document.getElementById('video-grid').classList.toggle('compact-view')">
                <i data-lucide="layout-grid" size="20" color="white"></i>
            </div>
            <div class="p-btn" style="width: 45px; height: 45px; background: #1a1a1a;" onclick="window.sortVideos()">
                <i data-lucide="arrow-up-down" size="20" color="white"></i>
            </div>
        </div>
    </div>

    <!-- ФИЛЬТРЫ ПО ЖАНРАМ -->
    <div style="display: flex; gap: 10px; margin-bottom: 30px; flex-wrap: wrap;">
        <button class="tab active" onclick="window.filterVideos('all', this)" style="background: white; color: black;">Все</button>
        <button class="tab" onclick="window.filterVideos('pop', this)">Pop</button>
    </div>

    <!-- ВИДЕО ПЛЕЕР НА ВСЮ СРЕДНЮЮ ПАНЕЛЬ -->
    <div id="video-player-section" style="width: 100%; margin-bottom: 40px; display: none;">
        <div style="position: relative; width: 100%; aspect-ratio: 16/9; background: #000; border-radius: 16px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.5);">
            <video id="video-player" style="width: 100%; height: 100%;" src="" playsinline></video>
            
            <!-- КАСТОМНЫЕ ЭЛЕМЕНТЫ УПРАВЛЕНИЯ (СКРЫТЫ, Т.К. УПРАВЛЯЕМ ЧЕРЕЗ НИЖНИЙ ПЛЕЕР) -->
            <div style="position: absolute; top: 20px; right: 20px; z-index: 10;">
                <div class="p-btn" style="width: 45px; height: 45px; background: rgba(0,0,0,0.7);" onclick="window.closeVideoPlayer()">
                    <i data-lucide="x" size="20" color="white"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- ГРИД С ВИДЕО -->
    <div id="video-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 24px;">
        <!-- Taylor Swift - 22 -->
        <div class="video-card" data-category="pop" onclick="window.playVideo(
            'https://s3.k-connect.ru/static/uploads/post/11561/FvHevpyAMu_Taylor_Swift_-_22_-_Taylor_Swift_1080p_h264.mp4',
            '22',
            'Taylor Swift',
            '3:52',
            'https://s3.k-connect.ru/static/uploads/comments/11561/sddefault.jpg',
            'https://s3.k-connect.ru/static/uploads/post/11563/ZiWYMMBLcz_channels4_profile%20(1).webp'
        )">
            <div class="video-thumbnail">
                <img src="https://s3.k-connect.ru/static/uploads/comments/11561/sddefault.jpg" class="video-thumbnail-img">
                <div class="video-duration">3:52</div>
                <div class="video-play-overlay">
                    <i data-lucide="play" size="40" color="white" fill="white"></i>
                </div>
            </div>
            <div style="display:flex; gap:12px; margin-top:12px;">
                <img src="https://s3.k-connect.ru/static/uploads/post/11563/ZiWYMMBLcz_channels4_profile%20(1).webp" style="width:40px; height:40px; border-radius:50%; object-fit:cover;">
                <div>
                    <b style="font-size:15px;">22</b>
                    <br>
                    <small style="color:#7a7a7a;">Taylor Swift</small>
                </div>
            </div>
        </div>

        <!-- Taylor Swift - Opalite -->
        <div class="video-card" data-category="pop" onclick="window.playVideo(
            'https://s3.k-connect.ru/static/uploads/post/11560/UipqebVHl8_Taylor_Swift_-_Opalite_Official_Music_Video_-_Taylor_Swift_1080p_h264.mp4',
            'Opalite',
            'Taylor Swift',
            '4:15',
            'https://s3.k-connect.ru/static/uploads/comments/11560/maxresdefault.jpg',
            'https://s3.k-connect.ru/static/uploads/post/11563/ZiWYMMBLcz_channels4_profile%20(1).webp'
        )">
            <div class="video-thumbnail">
                <img src="https://s3.k-connect.ru/static/uploads/comments/11560/maxresdefault.jpg" class="video-thumbnail-img">
                <div class="video-duration">4:15</div>
                <div class="video-play-overlay">
                    <i data-lucide="play" size="40" color="white" fill="white"></i>
                </div>
            </div>
            <div style="display:flex; gap:12px; margin-top:12px;">
                <img src="https://s3.k-connect.ru/static/uploads/post/11563/ZiWYMMBLcz_channels4_profile%20(1).webp" style="width:40px; height:40px; border-radius:50%; object-fit:cover;">
                <div>
                    <b style="font-size:15px;">Opalite</b>
                    <br>
                    <small style="color:#7a7a7a;">Taylor Swift</small>
                </div>
            </div>
        </div>

        <!-- Lady Gaga - Abracadabra -->
        <div class="video-card" data-category="pop" onclick="window.playVideo(
            'https://s3.k-connect.ru/static/uploads/post/11559/ABInwxgnTA_Lady_Gaga_-_Abracadabra_Official_Music_Video_-_LadyGagaVEVO_1080p_h264_2.mp4',
            'Abracadabra',
            'Lady Gaga',
            '3:43',
            'https://s3.k-connect.ru/static/uploads/comments/11559/maxresdefault_1.jpg',
            'https://s3.k-connect.ru/static/music/1475/5955/1770656744_cover.jpeg'
        )">
            <div class="video-thumbnail">
                <img src="https://s3.k-connect.ru/static/uploads/comments/11559/maxresdefault_1.jpg" class="video-thumbnail-img">
                <div class="video-duration">3:43</div>
                <div class="video-play-overlay">
                    <i data-lucide="play" size="40" color="white" fill="white"></i>
                </div>
            </div>
            <div style="display:flex; gap:12px; margin-top:12px;">
                <img src="https://s3.k-connect.ru/static/music/1475/5955/1770656744_cover.jpeg" style="width:40px; height:40px; border-radius:50%; object-fit:cover;">
                <div>
                    <b style="font-size:15px;">Abracadabra</b>
                    <br>
                    <small style="color:#7a7a7a;">Lady Gaga</small>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* ЕДИНЫЙ РАЗМЕР ДЛЯ ВСЕХ ОБЛОЖЕК */
    .video-thumbnail {
        position: relative;
        width: 100%;
        aspect-ratio: 16/9;
        border-radius: 12px;
        overflow: hidden;
        background: #1a1a1a;
    }
    
    .video-thumbnail-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        position: absolute;
        top: 0;
        left: 0;
    }
    
    .video-duration {
        position: absolute;
        bottom: 10px;
        right: 10px;
        background: rgba(0,0,0,0.8);
        color: white;
        padding: 4px 8px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
        z-index: 3;
    }
    
    .video-play-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.4);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: 0.3s;
        z-index: 2;
    }
    
    .video-card {
        cursor: pointer;
        transition: 0.3s;
        border-radius: 12px;
        background: transparent;
    }
    
    .video-card:hover .video-play-overlay {
        opacity: 1;
    }
    
    .compact-view .video-card {
        display: flex;
        gap: 16px;
        background: #1a1a1a;
        padding: 12px;
        border-radius: 12px;
    }
    
    .compact-view .video-thumbnail {
        width: 160px;
        aspect-ratio: 16/9;
        flex-shrink: 0;
    }
    
    .compact-view .video-card > div:last-child {
        margin-top: 0 !important;
        flex: 1;
    }
    
    #video-grid.compact-view {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }
    
    /* СТИЛИ ДЛЯ ПРАВОЙ ПАНЕЛИ - СПИСОК ВИДЕО */
    .recommendation-item {
        display: flex;
        gap: 12px;
        align-items: center;
        padding: 8px;
        cursor: pointer;
        border-radius: 8px;
        transition: 0.2s;
        margin-bottom: 8px;
    }
    
    .recommendation-item:hover {
        background: #1a1a1a;
    }
    
    .recommendation-thumbnail {
        width: 120px;
        aspect-ratio: 16/9;
        border-radius: 6px;
        overflow: hidden;
        background: #1a1a1a;
        flex-shrink: 0;
    }
    
    .recommendation-thumbnail img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    
    .recommendation-info {
        flex: 1;
    }
    
    .recommendation-title {
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 4px;
        display: block;
    }
    
    .recommendation-artist {
        font-size: 12px;
        color: #7a7a7a;
    }
    
    /* СКРЫВАЕМ СИСТЕМНЫЕ КОНТРОЛЫ ВИДЕО */
    #video-player::-webkit-media-controls {
        display: none !important;
    }
    
    #video-player::-webkit-media-controls-enclosure {
        display: none !important;
    }
    
    #video-player {
        -webkit-appearance: none;
        appearance: none;
    }
</style>

<script>
    (function() {
        'use strict';

        // ========== СОСТОЯНИЕ ВИДЕО ==========
        window.videoPlaylist = [];
        window.currentVideoIndex = -1;
        window.isVideoPlaying = false;
        window.videoLikes = {};

        // ========== ВОСПРОИЗВЕДЕНИЕ ВИДЕО ==========
        window.playVideo = function(videoUrl, title, artist, duration, coverArt, avatarUrl) {
            // Показываем секцию с видео
            const videoSection = document.getElementById('video-player-section');
            const videoElement = document.getElementById('video-player');
            
            if (!videoSection || !videoElement) return;
            
            videoSection.style.display = 'block';
            videoElement.src = videoUrl;
            videoElement.play();
            
            // Плавный скролл к видео
            setTimeout(() => {
                videoSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 100);
            
            // Сохраняем состояние
            window.currentVideoUrl = videoUrl;
            window.currentVideoTitle = title;
            window.currentVideoArtist = artist;
            window.currentVideoCover = coverArt;
            window.currentVideoAvatar = avatarUrl;
            window.currentVideoElement = videoElement;
            window.isVideoPlaying = true;
            
            // Обновляем интерфейс нижнего плеера
            document.getElementById('p-title').innerText = title;
            document.getElementById('p-artist').innerText = artist;
            document.getElementById('p-img').src = coverArt;
            document.getElementById('p-img').style.display = 'block';
            
            // Меняем кнопку на паузу
            const playBtn = document.getElementById('main-play-btn');
            if (playBtn) {
                playBtn.setAttribute('data-lucide', 'pause');
            }
            
            // Обновляем прогресс бар
            videoElement.ontimeupdate = function() {
                if (videoElement.duration) {
                    const pct = (videoElement.currentTime / videoElement.duration) * 100 || 0;
                    document.getElementById('p-fill').style.width = pct + '%';
                    document.getElementById('c-time').innerText = formatTime(videoElement.currentTime);
                    document.getElementById('d-time').innerText = formatTime(videoElement.duration);
                }
            };
            
            // Перемотка по клику на прогресс бар
            const barBg = document.querySelector('.bar-bg');
            if (barBg) {
                barBg.onclick = function(e) {
                    if (videoElement.duration) {
                        const rect = e.currentTarget.getBoundingClientRect();
                        const pct = (e.clientX - rect.left) / rect.width;
                        videoElement.currentTime = pct * videoElement.duration;
                    }
                };
            }
            
            // По окончании видео
            videoElement.onended = function() {
                window.playNextVideo();
            };
            
            // Обновляем иконку лайка
            const isLiked = window.videoLikes?.[videoUrl] || false;
            document.querySelectorAll('.like-btn').forEach(el => {
                el.classList.toggle('active', isLiked);
                el.setAttribute('fill', isLiked ? '#CC6B26' : 'none');
                el.setAttribute('color', isLiked ? '#CC6B26' : '#b3b3b3');
            });
            
            lucide.createIcons();
            
            // Обновляем правую панель
            window.updateRightPanel();
        };

        // ========== ЗАКРЫТЬ ВИДЕО ПЛЕЕР ==========
        window.closeVideoPlayer = function() {
            const videoSection = document.getElementById('video-player-section');
            const videoElement = document.getElementById('video-player');
            
            if (videoSection && videoElement) {
                videoSection.style.display = 'none';
                videoElement.pause();
                videoElement.src = '';
                window.currentVideoUrl = null;
                
                // Возвращаем плеер в исходное состояние
                document.getElementById('p-title').innerText = 'Выберите трек';
                document.getElementById('p-artist').innerText = '';
                document.getElementById('p-img').style.display = 'none';
                document.getElementById('p-fill').style.width = '0%';
                document.getElementById('c-time').innerText = '0:00';
                document.getElementById('d-time').innerText = '0:00';
                
                const playBtn = document.getElementById('main-play-btn');
                if (playBtn) {
                    playBtn.setAttribute('data-lucide', 'play');
                }
                
                lucide.createIcons();
            }
        };

        // ========== ФОРМАТ ВРЕМЕНИ ==========
        function formatTime(seconds) {
            if (!seconds || isNaN(seconds)) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return mins + ':' + (secs < 10 ? '0' : '') + secs;
        }

        // ========== ПЕРЕОПРЕДЕЛЯЕМ TogglePlay ==========
        const originalTogglePlay = window.togglePlay;
        window.togglePlay = function() {
            if (window.location.hash === '#videos' && window.currentVideoElement) {
                if (window.currentVideoElement.paused) {
                    window.currentVideoElement.play();
                    document.getElementById('main-play-btn')?.setAttribute('data-lucide', 'pause');
                    window.isVideoPlaying = true;
                } else {
                    window.currentVideoElement.pause();
                    document.getElementById('main-play-btn')?.setAttribute('data-lucide', 'play');
                    window.isVideoPlaying = false;
                }
                lucide.createIcons();
            } else {
                if (originalTogglePlay) originalTogglePlay();
            }
        };

        // ========== НАВИГАЦИЯ ПО ВИДЕО ==========
        window.playNextVideo = function() {
            const videos = Array.from(document.querySelectorAll('.video-card'));
            const currentIndex = videos.findIndex(v => {
                const onclick = v.getAttribute('onclick') || '';
                return onclick.includes(window.currentVideoUrl || '');
            });
            
            if (currentIndex < videos.length - 1) {
                videos[currentIndex + 1].click();
            }
        };

        window.playPreviousVideo = function() {
            const videos = Array.from(document.querySelectorAll('.video-card'));
            const currentIndex = videos.findIndex(v => {
                const onclick = v.getAttribute('onclick') || '';
                return onclick.includes(window.currentVideoUrl || '');
            });
            
            if (currentIndex > 0) {
                videos[currentIndex - 1].click();
            }
        };

        // ========== ПЕРЕОПРЕДЕЛЯЕМ NEXT/PREV ==========
        window.nextTrack = function() {
            if (window.location.hash === '#videos' && window.currentVideoUrl) {
                window.playNextVideo();
            } else {
                if (window.currentIdx < window.currentTracks.length - 1) {
                    window.playTrack(window.currentIdx + 1, window.currentTracks);
                }
            }
        };

        window.prevTrack = function() {
            if (window.location.hash === '#videos' && window.currentVideoUrl) {
                window.playPreviousVideo();
            } else {
                if (window.currentIdx > 0) {
                    window.playTrack(window.currentIdx - 1, window.currentTracks);
                }
            }
        };

        // ========== ПОДКЛЮЧАЕМ ГРОМКОСТЬ К ВИДЕО ==========
        const originalSetVolume = function(volume) {
            if (window.location.hash === '#videos' && window.currentVideoElement) {
                window.currentVideoElement.volume = volume;
            }
        };

        // Перехватываем изменение громкости
        const originalAudioVolume = Object.getOwnPropertyDescriptor(window.audio, 'volume');
        Object.defineProperty(window.audio, 'volume', {
            set: function(value) {
                if (window.location.hash === '#videos' && window.currentVideoElement) {
                    window.currentVideoElement.volume = value;
                }
                if (originalAudioVolume && originalAudioVolume.set) {
                    originalAudioVolume.set.call(this, value);
                }
            },
            get: function() {
                if (window.location.hash === '#videos' && window.currentVideoElement) {
                    return window.currentVideoElement.volume;
                }
                return originalAudioVolume ? originalAudioVolume.get.call(this) : 0.7;
            }
        });

        // ========== ОБНОВЛЕНИЕ ПРАВОЙ ПАНЕЛИ ==========
        window.updateRightPanel = function() {
            if (window.location.hash !== '#videos') return;
            
            const sidePanel = document.querySelector('.panel.side:last-child');
            if (!sidePanel) return;
            
            // Меняем заголовок
            const titleEl = sidePanel.querySelector('h2');
            if (titleEl) {
                titleEl.innerText = 'Смотрите так же';
                titleEl.style.fontSize = '24px';
                titleEl.style.fontWeight = '800';
            }
            
            // Убираем artist и cover
            const artistEl = document.getElementById('side-artist');
            if (artistEl) artistEl.style.display = 'none';
            
            const coverEl = document.getElementById('side-cover');
            if (coverEl) coverEl.style.display = 'none';
            
            // Убираем кнопку лайка
            const likeBtn = document.getElementById('like-side');
            if (likeBtn) likeBtn.style.display = 'none';
            
            // Получаем все видео
            const videos = Array.from(document.querySelectorAll('.video-card'));
            
            // Фильтруем текущее видео
            let recommendations = videos.filter(v => {
                const onclick = v.getAttribute('onclick') || '';
                return !onclick.includes(window.currentVideoUrl || '');
            });
            
            // Если нет текущего видео, показываем все
            if (!window.currentVideoUrl) {
                recommendations = videos;
            }
            
            // Перемешиваем
            const shuffled = [...recommendations];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            
            // Берем 8 рекомендаций
            const topRecs = shuffled.slice(0, 8);
            
            // Рендерим список
            const container = sidePanel.querySelector('div:last-child > div:last-child');
            if (container) {
                container.innerHTML = `
                    <div id="queue-list" style="overflow-y: auto; flex: 1; padding-right: 5px;">
                        ${topRecs.map(video => {
                            const thumbnail = video.querySelector('.video-thumbnail-img')?.src || '';
                            const title = video.querySelector('b')?.textContent || '';
                            const artist = video.querySelector('small')?.textContent || '';
                            const onclick = video.getAttribute('onclick') || '';
                            
                            return `
                                <div class="recommendation-item" onclick="${onclick.replace(/"/g, '&quot;')}">
                                    <div class="recommendation-thumbnail">
                                        <img src="${thumbnail}" loading="lazy">
                                    </div>
                                    <div class="recommendation-info">
                                        <span class="recommendation-title">${title}</span>
                                        <span class="recommendation-artist">${artist}</span>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            }
        };

        // ========== ФИЛЬТРАЦИЯ ВИДЕО ==========
        window.filterVideos = function(category, btn) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            btn.classList.add('active');
            
            const videos = document.querySelectorAll('.video-card');
            videos.forEach(video => {
                if (category === 'all') {
                    video.style.display = 'block';
                } else {
                    const videoCategory = video.getAttribute('data-category');
                    video.style.display = videoCategory === category ? 'block' : 'none';
                }
            });
            
            if (document.getElementById('video-grid').classList.contains('compact-view')) {
                videos.forEach(video => {
                    if (video.style.display === 'block') {
                        video.style.display = 'flex';
                    }
                });
            }
            
            window.updateRightPanel();
        };

        // ========== СОРТИРОВКА ==========
        window.sortVideos = function() {
            const grid = document.getElementById('video-grid');
            const videos = Array.from(document.querySelectorAll('.video-card'));
            
            videos.sort((a, b) => {
                const titleA = a.querySelector('b')?.textContent || '';
                const titleB = b.querySelector('b')?.textContent || '';
                return titleA.localeCompare(titleB);
            });
            
            grid.innerHTML = '';
            videos.forEach(video => grid.appendChild(video));
            lucide.createIcons();
            
            window.updateRightPanel();
        };

        // ========== ПЕРЕХВАТ ToggleLike ==========
        const originalToggleLike = window.toggleLike;
        window.toggleLike = function() {
            if (window.location.hash === '#videos' && window.currentVideoUrl) {
                if (!window.videoLikes) window.videoLikes = {};
                window.videoLikes[window.currentVideoUrl] = !window.videoLikes[window.currentVideoUrl];
                
                const isLiked = window.videoLikes[window.currentVideoUrl];
                document.querySelectorAll('.like-btn').forEach(el => {
                    el.classList.toggle('active', isLiked);
                    el.setAttribute('fill', isLiked ? '#CC6B26' : 'none');
                    el.setAttribute('color', isLiked ? '#CC6B26' : '#b3b3b3');
                });
                
                lucide.createIcons();
            } else {
                if (originalToggleLike) originalToggleLike();
            }
        };

        // ========== ПОДЕЛИТЬСЯ ==========
        window.shareVideo = function() {
            if (!window.currentVideoUrl) return;
            
            navigator.clipboard.writeText(window.currentVideoUrl).then(() => {
                alert('Ссылка на видео скопирована!');
            });
        };

        // ========== ИНИЦИАЛИЗАЦИЯ ==========
        setTimeout(() => {
            // Собираем видео в плейлист
            const videoCards = document.querySelectorAll('.video-card');
            window.videoPlaylist = Array.from(videoCards).map((card, index) => {
                const titleEl = card.querySelector('b');
                const artistEl = card.querySelector('small');
                const durationEl = card.querySelector('.video-duration');
                const thumbnailEl = card.querySelector('.video-thumbnail-img');
                const avatarEl = card.querySelector('img:last-child');
                
                return {
                    id: index,
                    title: titleEl?.textContent || 'Без названия',
                    artist: artistEl?.textContent || 'Неизвестный исполнитель',
                    duration: durationEl?.textContent || '3:00',
                    thumbnail: thumbnailEl?.src || '',
                    avatar: avatarEl?.src || '',
                    url: card.getAttribute('onclick')?.match(/'([^']+)'/)?.filter((m, i) => i === 1)?.[0] || ''
                };
            });
            
            lucide.createIcons();
            
            // Обновляем правую панель
            if (window.location.hash === '#videos') {
                window.updateRightPanel();
            }
        }, 100);
    })();
</script>
