<div style="display:flex; gap:30px; margin-bottom:40px;">
    <img id="album-cover-image" src="https://s3.k-connect.ru/static/music/1475/5955/1770656744_cover.jpeg" style="width:230px; height:230px; border-radius:10px; box-shadow: 0 20px 50px rgba(0,0,0,0.5);">
    <div style="display:flex; flex-direction:column; justify-content:space-between; height:230px;">
        <div>
            <small style="font-weight:800; color:#7a7a7a; letter-spacing:1px;">АЛЬБОМ</small>
            <h1 style="font-size:70px; font-weight:900; margin:10px 0; line-height:1;">Mayhem</h1>
            <div style="display:flex; align-items:center; gap:8px; margin-top:10px;">
                <span style="color:#7a7a7a;">Lady Gaga • 2025</span>
                <span style="color:#7a7a7a;">•</span>
                <span style="color:#7a7a7a;">17 песен</span>
            </div>
        </div>
        
        <div class="album-actions">
            <div id="album-main-play-btn" class="album-play-btn" onclick="toggleAlbumPlay()">
                <i id="album-play-icon" data-lucide="play" fill="white" color="white" size="28" style="margin-left:4px;"></i>
            </div>
            <div id="album-like-btn" class="album-like-btn" onclick="toggleAlbumLike()">
                <i data-lucide="heart" size="22" color="white" fill="none"></i>
            </div>
            <div id="album-pin-btn" class="album-pin-btn" onclick="toggleAlbumPin()">
                <i data-lucide="pin" size="22" color="white" fill="none"></i>
            </div>
        </div>
    </div>
</div>

<div id="album-list"></div>

<script>
    let isAlbumLiked = false;
    let isAlbumPinned = false;

    // --- ОСНОВНАЯ ФУНКЦИЯ РЕНДЕРА С ПОДСВЕТКОЙ И АНИМАЦИЕЙ ---
    function renderMayhemTracks() {
        const albumList = document.getElementById('album-list');
        if (albumList && window.albumTracks) {
            albumList.innerHTML = window.albumTracks.map((t, i) => {
                const isPlaying = (window.currentTracks === window.albumTracks && window.currentIdx === i);
                
                return `
                    <div class="track-row ${isPlaying ? 'playing' : ''}" onclick="window.playTrack(${i}, window.albumTracks)">
                        <div style="display:flex; align-items:center; justify-content:center; width:40px; height:24px;">
                            ${isPlaying ? 
                                `<div class="playing-indicator" style="display: flex; gap: 4px; align-items: center;">
                                    <span style="width: 4px; height: 4px; background: #CC6B26; border-radius: 50%; animation: pulse 1.2s infinite;"></span>
                                    <span style="width: 4px; height: 4px; background: #CC6B26; border-radius: 50%; animation: pulse 1.2s infinite; animation-delay: 0.4s;"></span>
                                    <span style="width: 4px; height: 4px; background: #CC6B26; border-radius: 50%; animation: pulse 1.2s infinite; animation-delay: 0.8s;"></span>
                                </div>` : 
                                `<span style="color:#7a7a7a; font-size:14px; font-weight:400;">${i+1}</span>`
                            }
                        </div>
                        <b style="${isPlaying ? 'color: #CC6B26 !important;' : ''}">${t.title}</b>
                        <span style="text-align:right; color:#7a7a7a">${t.time}</span>
                    </div>
                `;
            }).join('');
            
            lucide.createIcons();
        }
    }

    // --- ПЕРЕОПРЕДЕЛЯЕМ МЕТОДЫ ПЛЕЕРА ДЛЯ АВТООБНОВЛЕНИЯ ---
    const originalPlayTrack = window.playTrack;
    window.playTrack = function(idx, trackList) {
        originalPlayTrack(idx, trackList);
        // Обновляем список, если это наш альбом
        if (trackList === window.albumTracks) {
            setTimeout(renderMayhemTracks, 30);
        }
    };

    const originalTogglePlay = window.togglePlay;
    window.togglePlay = function() {
        originalTogglePlay();
        if (window.currentTracks === window.albumTracks) {
            setTimeout(renderMayhemTracks, 30);
        }
    };

    // --- СЛУШАЕМ СОБЫТИЯ АУДИО ДЛЯ МГНОВЕННОЙ СМЕНЫ ИКОНКИ PLAY/PAUSE ---
    if (window.audio) {
        window.audio.addEventListener('play', () => {
            if (window.currentTracks === window.albumTracks) renderMayhemTracks();
        });
        window.audio.addEventListener('pause', () => {
            if (window.currentTracks === window.albumTracks) renderMayhemTracks();
        });
    }

    // --- ЛОГИКА ЛАЙКА И ПИНА ---
    window.toggleAlbumPlay = function() {
        if (!window.albumTracks) return;
        if (window.currentTracks === window.albumTracks && window.audio.src) {
            window.togglePlay();
        } else {
            if (window.currentTracks === window.albumTracks && window.currentIdx !== -1) {
                window.playTrack(window.currentIdx, window.albumTracks);
            } else {
                window.playTrack(0, window.albumTracks);
            }
        }
    };

    window.toggleAlbumLike = function() {
        isAlbumLiked = !isAlbumLiked;
        const btn = document.getElementById('album-like-btn');
        const icon = btn.querySelector('i');
        btn.classList.toggle('active', isAlbumLiked);
        icon.setAttribute('fill', isAlbumLiked ? 'white' : 'none');
        lucide.createIcons();
    };

    window.toggleAlbumPin = function() {
        isAlbumPinned = !isAlbumPinned;
        const btn = document.getElementById('album-pin-btn');
        const icon = btn.querySelector('i');
        
        if (isAlbumPinned) {
            btn.classList.add('active');
            icon.setAttribute('fill', 'white');
            window.pinnedAlbum = {
                name: "Mayhem",
                sub: "Альбом • 2025",
                cover: "https://s3.k-connect.ru/static/music/1475/5955/1770656744_cover.jpeg"
            };
        } else {
            btn.classList.remove('active');
            icon.setAttribute('fill', 'none');
            window.pinnedAlbum = null;
        }
        lucide.createIcons();
        
        // Обновляем главную, если она открыта
        if (location.hash === '#home' && window.renderPinnedAlbum) {
            setTimeout(window.renderPinnedAlbum, 50);
        }
    };

    // --- СТАРТ ---
    renderMayhemTracks();
    // Дополнительная страховка для обновления после загрузки DOM
    setTimeout(renderMayhemTracks, 50);
    lucide.createIcons();
</script>
