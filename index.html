<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deynik Music</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* ВИДЕО СТИЛИ */
        .video-card {
            cursor: pointer;
            transition: 0.3s;
            border-radius: 12px;
            background: transparent;
        }
        .video-card:hover .video-play-overlay { opacity: 1; }
        .video-thumbnail {
            position: relative;
            width: 100%;
            aspect-ratio: 16/9;
            border-radius: 12px;
            overflow: hidden;
            background: #1a1a1a;
        }
        .video-thumbnail-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 0;
        }
        .video-duration {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            z-index: 3;
        }
        .video-play-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: 0.3s;
            z-index: 2;
        }
        .recommendation-item {
            display: flex;
            gap: 12px;
            align-items: center;
            padding: 8px;
            cursor: pointer;
            border-radius: 8px;
            transition: 0.2s;
            margin-bottom: 8px;
        }
        .recommendation-item:hover {
            background: #1a1a1a;
        }
        .recommendation-thumbnail {
            width: 120px;
            aspect-ratio: 16/9;
            border-radius: 6px;
            overflow: hidden;
            background: #1a1a1a;
            flex-shrink: 0;
        }
        .recommendation-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .kinescope-player {
            position: relative;
            width: 100%;
            aspect-ratio: 16/9;
            background: #000;
            border-radius: 16px;
            overflow: hidden;
        }
        .kinescope-player iframe {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            border: 0;
        }
        
        /* КНОПКА ПЛЕЙ НА АЛЬБОМЕ */
        .album-card {
            position: relative;
        }
        .album-play-small {
            position: absolute;
            bottom: 70px;
            right: 25px;
            width: 45px;
            height: 45px;
            background: #CC6B26;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: 0.2s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            cursor: pointer;
            z-index: 5;
        }
        .album-card:hover .album-play-small {
            opacity: 1;
        }
        .album-play-small:hover {
            transform: scale(1.1);
            background: #e07c3a;
        }
        
        /* НОВАЯ НАВИГАЦИЯ */
        .nav-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
            justify-content: center;
        }
        
        .music-nav-btn, .video-nav-btn {
            padding: 8px 20px;
            border-radius: 30px;
            background: transparent;
            color: #b3b3b3;
            font-weight: 500;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: 0.2s;
            border: 1px solid transparent;
        }
        
        .music-nav-btn:hover, .video-nav-btn:hover {
            background: rgba(255,255,255,0.05);
            color: white;
        }
        
        .music-nav-btn.active, .video-nav-btn.active {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .music-nav-btn i, .video-nav-btn i {
            color: #b3b3b3;
        }
        
        .music-nav-btn.active i, .video-nav-btn.active i {
            color: white;
        }
        
        /* АВТОРИЗАЦИЯ */
        .auth-section {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            width: 380px;
        }
        
        .google-login-btn {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            color: white;
            padding: 8px 16px;
            border-radius: 30px;
            cursor: pointer;
            font-size: 13px;
            transition: 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .google-login-btn:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            padding: 4px 12px 4px 4px;
            border-radius: 30px;
            cursor: pointer;
            transition: 0.2s;
            position: relative;
        }
        
        .user-profile:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #CC6B26, #a0501e);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            color: white;
        }
        
        .user-name {
            font-size: 13px;
            max-width: 100px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            color: white;
        }
        
        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: #1a1a1a;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 8px 0;
            margin-top: 8px;
            min-width: 160px;
            z-index: 100;
            display: none;
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
        }
        
        .user-dropdown.show {
            display: block;
        }
        
        .dropdown-item {
            padding: 10px 16px;
            cursor: pointer;
            transition: 0.2s;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #e0e0e0;
        }
        
        .dropdown-item:hover {
            background: rgba(255,255,255,0.05);
            color: white;
        }
        
        /* ЛОГО */
        .logo-area {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            width: auto;
        }
        
        .logo-area h1 {
            font-size: 24px;
            font-weight: 800;
            letter-spacing: -1px;
            color: white;
        }
        
        .logo-svg polygon {
            fill: #CC6B26;
            rx: 12;
            ry: 12;
        }
        
        .logo-svg path {
            stroke: #CC6B26;
            transform: translate(12px, 0);
        }
        
        /* ПОИСК */
        .search-container {
            flex: 0 1 400px;
            display: flex;
            justify-content: center;
            margin: 0 16px;
        }
        
        .search-input {
            width: 100%;
            height: 40px;
            background: #1a1a1a;
            border-radius: 20px;
            border: none;
            color: white;
            text-align: center;
            opacity: 0.6;
            transition: 0.2s;
            font-size: 14px;
        }
        
        .search-input:focus {
            opacity: 1;
            background: #252525;
            outline: none;
        }
        
        /* ТОП НАВ */
        .top-nav {
            height: 70px;
            display: flex;
            align-items: center;
            padding: 0 24px;
            justify-content: space-between;
            background: #000;
        }

        /* УВЕДОМЛЕНИЯ */
        .notification {
            position: fixed;
            bottom: 100px;
            right: 30px;
            color: white;
            padding: 12px 24px;
            border-radius: 30px;
            z-index: 9999;
            font-size: 14px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transition: opacity 0.3s;
            opacity: 0;
        }
    </style>
</head>
<body>
    <header class="top-nav">
        <div class="logo-area" onclick="location.hash='#home'">
            <h1>Deynik Music</h1>
            <svg class="logo-svg" width="40" height="40" viewBox="0 0 100 100">
                <polygon points="15,15 70,50 15,85" fill="#CC6B26" rx="12" ry="12"/>
                <path d="M70,30 Q95,50 70,70 M88,15 Q120,50 88,85" stroke="#CC6B26" fill="none" stroke-width="8" stroke-linecap="round" transform="translate(12, 0)"/>
            </svg>
        </div>
        
        <div class="nav-wrapper">
            <button class="music-nav-btn active" onclick="location.hash='#home'">
                <i data-lucide="music" size="18"></i>
                Музыка
            </button>
            <button class="video-nav-btn" onclick="location.hash='#videos'">
                <i data-lucide="video" size="18"></i>
                Клипы
            </button>
            <div class="search-container">
                <input type="text" class="search-input" placeholder="Поиск треков или исполнителей">
            </div>
        </div>
        
        <div class="auth-section" id="auth-section">
            <button class="google-login-btn" id="googleLoginBtn">
                <i data-lucide="user" size="16"></i>
                Войти через Google
            </button>
        </div>
    </header>

    <div class="app-main">
        <aside class="panel side">
            <div class="filter-nav">
                <div class="filter-scroll scroll-hide" id="filterScroll">
                    <button class="tab active" onclick="filterSide('all', this)"><i data-lucide="home" size="16"></i></button>
                    <button class="tab" onclick="filterSide('artist', this)">Исполнители</button>
                    <button class="tab" onclick="filterSide('album', this)">Альбомы</button>
                    <button class="tab" onclick="filterSide('playlist', this)">Плейлисты</button>
                </div>
            </div>
            <div id="side-list" class="scroll-hide" style="overflow-y: auto;">
                <div class="side-item">
                    <div style="width:52px; height:52px; border-radius:6px; background: linear-gradient(135deg, #450af5, #c4efd9); display:flex; align-items:center; justify-content:center;">
                        <i data-lucide="heart" fill="white" color="white" size="24"></i>
                    </div>
                    <div style="margin-left:8px;"><b>Любимые треки</b><br><small style="color:#7a7a7a;">Плейлист • 0 треков</small></div>
                </div>
                <div id="filtered-content"></div>
                <div id="pinned-side-container" style="margin-top: 20px;"></div>
            </div>
        </aside>

        <main class="panel center scroll-hide" id="content-area"></main>

        <aside class="panel side">
            <img id="side-cover" src="" style="width:100%; border-radius:10px; margin-bottom:20px; display: none;">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <div>
                    <h2 id="side-title" style="font-size:24px; font-weight:800;">Выберите трек</h2>
                    <p id="side-artist" style="color:#7a7a7a; font-size:17px;"></p>
                </div>
                <i data-lucide="heart" id="like-side" class="like-btn" onclick="toggleLike()"></i>
            </div>
            <div style="margin-top:35px; display: flex; flex-direction: column; flex: 1; min-height: 0;">
                <p style="font-weight:700; margin-bottom:12px; font-size:12px; color:#7a7a7a; text-transform:uppercase;">Очередь</p>
                <div id="queue-list" class="scroll-hide" style="overflow-y: auto; flex: 1;"></div>
            </div>
        </aside>
    </div>

    <footer class="player-bar">
        <div style="display:flex; align-items:center; gap:15px; transform: translateY(-4px);">
            <img id="p-img" src="" style="width:58px; height:58px; border-radius:4px; background:#1a1a1a; display:none;">
            <div>
                <b id="p-title" style="font-size:15px; display:block; font-weight:600;">Выберите трек</b>
                <span id="p-artist" style="color:#7a7a7a; font-size:13px;"></span>
            </div>
            <i data-lucide="heart" id="like-player" size="20" class="like-btn" style="margin-left:20px;" onclick="toggleLike()"></i>
        </div>

        <div style="display:flex; flex-direction:column; align-items:center; gap:6px; transform: translateY(-4px);">
            <div style="display:flex; align-items:center; gap:20px;">
                <div class="p-btn" onclick="prevTrack()"><i data-lucide="skip-back" fill="white" size="18"></i></div>
                <div class="p-btn" style="background:white; color:black;" onclick="togglePlay()">
                    <i id="main-play-btn" data-lucide="play" fill="black" size="22" style="margin-left:2px;"></i>
                </div>
                <div class="p-btn" onclick="nextTrack()"><i data-lucide="skip-forward" fill="white" size="18"></i></div>
            </div>
            <div style="display:flex; align-items:center; gap:12px; width:100%; max-width:550px;">
                <span id="c-time" style="font-size:11px; color:#7a7a7a; width:35px;">0:00</span>
                <div class="bar-bg" onclick="seek(event)">
                    <div id="p-fill" class="bar-fill"></div>
                </div>
                <span id="d-time" style="font-size:11px; color:#7a7a7a; width:35px;">0:00</span>
            </div>
        </div>

        <div style="display:flex; justify-content:flex-end; align-items:center; transform: translateY(-4px);">
            <div style="display:flex; align-items:center; gap:12px;" onwheel="handleVolumeWheel(event)">
                <i data-lucide="volume-2" size="18" color="#7a7a7a"></i>
                <div class="vol-slider" id="vol-slider" onmousedown="startVolDrag(event)">
                    <div id="v-fill" class="vol-fill" style="width:70%;"></div>
                </div>
            </div>
        </div>
    </footer>

    <div class="notification" id="notification"></div>

    <script>
        // ========== FIREBASE КОНФИГУРАЦИЯ ==========
        const firebaseConfig = {
            apiKey: "AIzaSyBk4nxZ1ldNQUCxsbgaeYTkm9stq0o9o2Q",
            authDomain: "deygram-e4814.firebaseapp.com",
            projectId: "deygram-e4814",
            storageBucket: "deygram-e4814.firebasestorage.app",
            messagingSenderId: "591207353726",
            appId: "1:591207353726:web:d20f5e648d3daf86fcb72f"
        };

        // Инициализация Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // ========== ГЛОБАЛЬНЫЕ ПЕРЕМЕННЫЕ ==========
        window.albumTracks = [
            {title:"Disease", url:"https://s3.k-connect.ru/static/music/1475/5954/1770656682_Lady_Gaga_-_Disease.mp3", time:"3:50"},
            {title:"Abracadabra", url:"https://s3.k-connect.ru/static/music/1475/5955/1770656744_Lady_Gaga_-_Abracadabra.mp3", time:"3:43"},
            {title:"Garden Of Eden", url:"https://s3.k-connect.ru/static/music/1475/5956/1770656858_Lady_Gaga_-_Garden_Of_Eden.mp3", time:"3:59"},
            {title:"Perfect Celebrity", url:"https://s3.k-connect.ru/static/music/1475/5957/1770656859_Lady_Gaga_-_Perfect_Celebrity.mp3", time:"3:49"},
            {title:"Can't Stop the High", url:"https://s3.k-connect.ru/static/music/1475/5958/1770656859_Lady_Gaga_-_Can_t_Stop_the_High.mp3", time:"3:32"},
            {title:"Vanish Into You", url:"https://s3.k-connect.ru/static/music/1475/5959/1770656860_Lady_Gaga_-_Vanish_Into_You.mp3", time:"4:04"},
            {title:"Killah", url:"https://s3.k-connect.ru/static/music/1475/5960/1770656860_Lady_Gaga_-_Killah.mp3", time:"3:30"},
            {title:"Zombieboy", url:"https://s3.k-connect.ru/static/music/1475/5961/1770656861_Lady_Gaga_-_Zombieboy.mp3", time:"3:33"},
            {title:"The Dead Dance", url:"https://s3.k-connect.ru/static/music/1475/5962/1770656861_Lady_Gaga_-_The_Dead_Dance.mp3", time:"3:47"},
            {title:"LoveDrug", url:"https://s3.k-connect.ru/static/music/1475/5963/1770656862_Lady_Gaga_-_LoveDrug.mp3", time:"3:13"},
            {title:"How Bad Do U Want Me", url:"https://s3.k-connect.ru/static/music/1475/5964/1770656932_Lady_Gaga_-_How_Bad_Do_U_Want_Me.mp3", time:"3:58"},
            {title:"Don't Call Tonight", url:"https://s3.k-connect.ru/static/music/1475/5965/1770656932_Lady_Gaga_-_Don_t_Call_Tonight.mp3", time:"3:45"},
            {title:"Kill For Love", url:"https://s3.k-connect.ru/static/music/1475/5966/1770656933_Lady_Gaga_-_Kill_For_Love.mp3", time:"3:38"},
            {title:"Shadow Of A Man", url:"https://s3.k-connect.ru/static/music/1475/5967/1770656933_Lady_Gaga_-_Shadow_Of_A_Man.mp3", time:"3:19"},
            {title:"The Beast", url:"https://s3.k-connect.ru/static/music/1475/5968/1770656934_Lady_Gaga_-_The_Beast.mp3", time:"3:54"},
            {title:"Blade Of Grass", url:"https://s3.k-connect.ru/static/music/1475/5969/1770656934_Lady_Gaga_-_Blade_Of_Grass.mp3", time:"4:17"},
            {title:"Die With A Smile", url:"https://s3.k-connect.ru/static/music/1475/5970/1770656935_Lady_Gaga_-_Die_With_A_Smile.mp3", time:"4:11"}
        ];
        
        // ========== ТРЕКИ АЛЬБОМА RED ==========
        window.redTracks = [
            {title:"State Of Grace (Taylor's Version)", url:"https://s3.k-connect.ru/static/music/1475/5973/1770895500_Taylor_Swift_-_State_Of_Grace_Taylor_s_Version.mp3", time:"4:55"},
            {title:"Red (Taylor's Version)", url:"https://s3.k-connect.ru/static/music/1475/5974/1770895501_Taylor_Swift_-_Red_Taylor_s_Version.mp3", time:"3:43"},
            {title:"Treacherous (Taylor's Version)", url:"https://s3.k-connect.ru/static/music/1475/5975/1770895501_Taylor_Swift_-_Treacherous_Taylor_s_Version.mp3", time:"4:02"},
            {title:"I Knew You Were Trouble (Taylor's Version)", url:"https://s3.k-connect.ru/static/music/1475/5976/1770895502_Taylor_Swift_-_I_Knew_You_Were_Trouble_Taylor_s_Version.mp3", time:"3:39"},
            {title:"All Too Well (Taylor's Version)", url:"https://s3.k-connect.ru/static/music/1475/5977/1770895502_Taylor_Swift_-_All_Too_Well_Taylor_s_Version.mp3", time:"5:29"},
            {title:"22 (Taylor's Version)", url:"https://s3.k-connect.ru/static/music/1475/5978/1770895503_Taylor_Swift_-_22_Taylor_s_Version.mp3", time:"3:52"},
            {title:"I Almost Do (Taylor's Version)", url:"https://s3.k-connect.ru/static/music/1475/5979/1770895503_Taylor_Swift_-_I_Almost_Do_Taylor_s_Version.mp3", time:"4:04"},
            {title:"We Are Never Ever Getting Back Together (Taylor's Version)", url:"https://s3.k-connect.ru/static/music/1475/5980/1770895504_Taylor_Swift_We_Are_Never_Ever_Getting_Back_Together_Taylor_s.mp3", time:"3:13"},
            {title:"Stay Stay Stay (Taylor's Version)", url:"https://s3.k-connect.ru/static/music/1475/5981/1770895504_Taylor_Swift_-_Stay_Stay_Stay_Taylor_s_Version.mp3", time:"3:25"},
            {title:"The Last Time (Taylor's Version)", url:"https://s3.k-connect.ru/static/music/1475/5982/1770895505_Taylor_Swift_-_The_Last_Time_Taylor_s_Version.mp3", time:"4:59"},
            {title:"Holy Ground (Taylor's Version)", url:"https://s3.k-connect.ru/static/music/1475/5983/1770896065_Taylor_Swift_-_Holy_Ground_Taylor_s_Version.mp3", time:"3:22"},
            {title:"Sad Beautiful Tragic (Taylor's Version)", url:"https://s3.k-connect.ru/static/music/1475/5984/1770896066_Taylor_Swift_-_Sad_Beautiful_Tragic_Taylor_s_Version.mp3", time:"4:44"},
            {title:"The Lucky One (Taylor's Version)", url:"https://s3.k-connect.ru/static/music/1475/5985/1770896066_Taylor_Swift_-_The_Lucky_One_Taylor_s_Version.mp3", time:"4:00"},
            {title:"Everything Has Changed (Taylor's Version)", url:"https://s3.k-connect.ru/static/music/1475/5986/1770896066_Taylor_Swift_-_Everything_Has_Changed_Taylor_s_Version.mp3", time:"4:05"},
            {title:"Starlight (Taylor's Version)", url:"https://s3.k-connect.ru/static/music/1475/5987/1770896067_Taylor_Swift_-_Starlight_Taylor_s_Version.mp3", time:"3:40"},
            {title:"Begin Again (Taylor's Version)", url:"https://s3.k-connect.ru/static/music/1475/5988/1770896067_Taylor_Swift_-_Begin_Again_Taylor_s_Version.mp3", time:"3:58"},
            {title:"The Moment I Knew (Taylor's Version)", url:"https://s3.k-connect.ru/static/music/1475/5989/1770896068_Taylor_Swift_-_The_Moment_I_Knew_Taylor_s_Version.mp3", time:"4:46"},
            {title:"Come Back... Be Here (Taylor's Version)", url:"https://s3.k-connect.ru/static/music/1475/5990/1770896069_Taylor_Swift_-_Come_Back...Be_Here_Taylor_s_Version.mp3", time:"3:43"},
            {title:"Girl At Home (Taylor's Version)", url:"https://s3.k-connect.ru/static/music/1475/5991/1770896069_Taylor_Swift_-_Girl_At_Home_Taylor_s_Version.mp3", time:"3:40"},
            {title:"State Of Grace (Acoustic Version) (Taylor's Version)", url:"https://s3.k-connect.ru/static/music/1475/5992/1770896071_Taylor_Swift_State_Of_Grace_Acoustic_Version_Taylor_s_Versi.mp3", time:"5:21"},
            {title:"Ronan (Taylor's Version)", url:"https://s3.k-connect.ru/static/music/1475/5993/1770896916_Taylor_Swift_-_Ronan_Taylor_s_Version.mp3", time:"4:24"},
            {title:"Better Man (Taylor's Version) (From The Vault)", url:"https://s3.k-connect.ru/static/music/1475/5994/1770896916_Taylor_Swift_Better_Man_Taylor_s_Version_From_The_Vault.mp3", time:"4:57"},
            {title:"Nothing New (Taylor's Version) (From The Vault)", url:"https://s3.k-connect.ru/static/music/1475/5995/1770896917_Taylor_Swift_Nothing_New_Taylor_s_Version_From_The_Vault.mp3", time:"4:18"},
            {title:"Babe (Taylor's Version) (From The Vault)", url:"https://s3.k-connect.ru/static/music/1475/5996/1770896917_Taylor_Swift_-_Babe_Taylor_s_Version_From_The_Vault.mp3", time:"3:44"},
            {title:"Message In A Bottle (Taylor's Version) (From The Vault)", url:"https://s3.k-connect.ru/static/music/1475/5997/1770896917_Taylor_Swift_Message_In_A_Bottle_Taylor_s_Version_From_The.mp3", time:"3:45"},
            {title:"I Bet You Think About Me (Taylor's Version) (From The Vault)", url:"https://s3.k-connect.ru/static/music/1475/5998/1770896918_Taylor_Swift_I_Bet_You_Think_About_Me_Taylor_s_Version_From.mp3", time:"4:45"},
            {title:"Forever Winter (Taylor's Version) (From The Vault)", url:"https://s3.k-connect.ru/static/music/1475/5999/1770896919_Taylor_Swift_Forever_Winter_Taylor_s_Version_From_The_Vault.mp3", time:"4:23"},
            {title:"Run (Taylor's Version) (From The Vault)", url:"https://s3.k-connect.ru/static/music/1475/6000/1770896919_Taylor_Swift_-_Run_Taylor_s_Version_From_The_Vault.mp3", time:"4:00"},
            {title:"The Very First Night (Taylor's Version) (From The Vault)", url:"https://s3.k-connect.ru/static/music/1475/6001/1770896921_Taylor_Swift_The_Very_First_Night_Taylor_s_Version_From_The.mp3", time:"3:20"},
            {title:"All Too Well (10 Minute Version) (Taylor's Version) (From The Vault)", url:"https://s3.k-connect.ru/static/music/1475/6002/1770896922_Taylor_Swift_All_Too_Well_10_Minute_Version_Taylor_s_Versio.mp3", time:"10:13"}
        ];

        // ========== ВИДЕО БАЗА ==========
        window.videoDatabase = [
            {
                id: 'abracadabra',
                title: 'Abracadabra',
                artist: 'Lady Gaga',
                duration: '3:43',
                embedUrl: 'https://kinescope.io/embed/23P3nMBcJP5impENM59GKy?autoplay=1',
                thumbnail: 'https://s3.k-connect.ru/static/uploads/comments/11559/maxresdefault_1.jpg',
                avatar: 'https://s3.k-connect.ru/static/music/1475/5955/1770656744_cover.jpeg',
                category: 'pop'
            },
            {
                id: '22',
                title: '22',
                artist: 'Taylor Swift',
                duration: '3:52',
                embedUrl: 'https://kinescope.io/embed/6jSnedNm6D26XFkfqRZ1xi?autoplay=1',
                thumbnail: 'https://s3.k-connect.ru/static/uploads/comments/11561/sddefault.jpg',
                avatar: 'https://s3.k-connect.ru/static/uploads/post/11563/ZiWYMMBLcz_channels4_profile%20(1).webp',
                category: 'pop'
            },
            {
                id: 'opalite',
                title: 'Opalite',
                artist: 'Taylor Swift',
                duration: '4:15',
                embedUrl: 'https://kinescope.io/embed/4v59o3MEohNejrECfLGgAc?autoplay=1',
                thumbnail: 'https://s3.k-connect.ru/static/uploads/comments/11560/maxresdefault.jpg',
                avatar: 'https://s3.k-connect.ru/static/uploads/post/11563/ZiWYMMBLcz_channels4_profile%20(1).webp',
                category: 'pop'
            }
        ];

        // ========== АУДИО ПЕРЕМЕННЫЕ ==========
        let audio = new Audio();
        let currentTracks = [];
        let currentIdx = -1;
        let isLiked = false;
        let isVolDragging = false;
        const albumCover = 'https://s3.k-connect.ru/static/music/1475/5955/1770656744_cover.jpeg';
        const redCover = 'https://s3.k-connect.ru/static/music/1475/5978/1770895503_cover.jpeg';
        window.pinnedAlbum = null;
        window.trackLikes = {};
        window.videoLikes = {};
        window.currentVideoId = null;
        window.currentVideoIframe = null;
        window.isVideoPlaying = false;
        
        window.audio = audio;
        window.currentTracks = currentTracks;
        window.currentIdx = currentIdx;

        // ========== ПЕРЕМЕННЫЕ АВТОРИЗАЦИИ ==========
        let userNickname = localStorage.getItem('userNickname') || '';

        // ========== УВЕДОМЛЕНИЯ ==========
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.style.background = type === 'success' ? '#CC6B26' : type === 'error' ? '#ff4444' : '#333';
            notification.textContent = message;
            notification.style.opacity = '1';
            
            setTimeout(() => {
                notification.style.opacity = '0';
            }, 3000);
        }

        // ========== АВТОРИЗАЦИЯ ==========
        function signInWithGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            
            auth.signInWithPopup(provider)
                .then((result) => {
                    showNotification(`Добро пожаловать, ${result.user.displayName || 'Пользователь'}!`, 'success');
                })
                .catch((error) => {
                    console.error('Ошибка входа:', error);
                    showNotification('Ошибка входа: ' + error.message, 'error');
                });
        }

        function signOut() {
            auth.signOut().then(() => {
                showNotification('Вы вышли из аккаунта', 'success');
            });
        }

        function updateAuthUI(user) {
            const authSection = document.getElementById('auth-section');
            if (!authSection) return;
            
            if (user) {
                const displayName = userNickname || user.displayName || 'Пользователь';
                const firstLetter = displayName.charAt(0).toUpperCase();
                const photoURL = user.photoURL;
                
                let avatarHtml = '';
                if (photoURL) {
                    avatarHtml = `<img src="${photoURL}" style="width:32px; height:32px; border-radius:50%; object-fit:cover;">`;
                } else {
                    avatarHtml = `<div class="user-avatar">${firstLetter}</div>`;
                }
                
                authSection.innerHTML = `
                    <div class="user-profile" id="userProfile">
                        ${avatarHtml}
                        <span class="user-name">${displayName}</span>
                        <div class="user-dropdown" id="userDropdown">
                            <div class="dropdown-item" id="signOutBtn">
                                <i data-lucide="log-out" size="16"></i>
                                Выйти
                            </div>
                        </div>
                    </div>
                `;
                
                lucide.createIcons();
                
                const userProfile = document.getElementById('userProfile');
                const userDropdown = document.getElementById('userDropdown');
                const signOutBtn = document.getElementById('signOutBtn');
                
                userProfile.addEventListener('click', function(e) {
                    e.stopPropagation();
                    userDropdown.classList.toggle('show');
                });
                
                signOutBtn.addEventListener('click', signOut);
                
            } else {
                authSection.innerHTML = `
                    <button class="google-login-btn" id="googleLoginBtn">
                        <i data-lucide="user" size="16"></i>
                        Войти через Google
                    </button>
                `;
                
                lucide.createIcons();
                
                document.getElementById('googleLoginBtn').addEventListener('click', signInWithGoogle);
            }
        }

        // ========== МОЙ VIBE ==========
        window.isVibePlaying = false;
        window.vibeTracks = [];

        window.toggleVibePlay = function() {
            const vibeIcon = document.getElementById('vibePlayIcon');
            
            if (!window.isVibePlaying) {
                if (!window.vibeTracks.length) {
                    window.vibeTracks = [...window.albumTracks, ...window.redTracks];
                }
                
                const shuffled = [...window.vibeTracks];
                for (let i = shuffled.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                }
                
                window.currentTracks = [];
                window.currentIdx = -1;
                renderQueue();
                
                setTimeout(() => {
                    window.playTrack(0, shuffled);
                    window.isVibePlaying = true;
                    if (vibeIcon) {
                        vibeIcon.setAttribute('data-lucide', 'pause');
                        lucide.createIcons();
                    }
                }, 50);
            } else {
                window.togglePlay();
                window.isVibePlaying = !audio.paused;
                if (vibeIcon) {
                    vibeIcon.setAttribute('data-lucide', audio.paused ? 'play' : 'pause');
                    lucide.createIcons();
                }
            }
        };

        // ========== ЗАГРУЗКА КОНТЕНТА ==========
        async function loadContent() {
            let hash = location.hash.replace('#', '') || 'home';
            
            // Обновляем активную кнопку навигации
            if (hash === 'videos' || hash.startsWith('video-')) {
                document.querySelector('.music-nav-btn')?.classList.remove('active');
                document.querySelector('.video-nav-btn')?.classList.add('active');
            } else {
                document.querySelector('.music-nav-btn')?.classList.add('active');
                document.querySelector('.video-nav-btn')?.classList.remove('active');
            }
            
            // ВИДЕО СТРАНИЦЫ
            if (hash === 'videos') {
                audio.pause();
                window.currentTracks = [];
                window.currentIdx = -1;
                
                document.getElementById('content-area').innerHTML = generateVideosPage();
                updateRightPanelForVideos();
                document.title = 'Видеоклипы | Deynik Music';
                lucide.createIcons();
            }
            else if (hash.startsWith('video-')) {
                audio.pause();
                window.currentTracks = [];
                window.currentIdx = -1;
                
                const videoId = hash.replace('video-', '');
                const video = window.videoDatabase.find(v => v.id === videoId);
                if (video) {
                    document.getElementById('content-area').innerHTML = generateVideoPage(video);
                    updateRightPanelForVideos(video);
                    document.title = `${video.title} - ${video.artist} | Deynik Music`;
                    window.currentVideoId = video.id;
                    
                    setTimeout(() => {
                        document.getElementById('p-title').innerText = video.title;
                        document.getElementById('p-artist').innerText = video.artist;
                        document.getElementById('p-img').src = video.thumbnail;
                        document.getElementById('p-img').style.display = 'block';
                        document.getElementById('main-play-btn').setAttribute('data-lucide', 'pause');
                        window.isVideoPlaying = true;
                        lucide.createIcons();
                        
                        window.currentVideoIframe = document.querySelector('#video-player-section iframe');
                    }, 500);
                }
                lucide.createIcons();
            }
            // АУДИО СТРАНИЦЫ
            else {
                try {
                    const res = await fetch(`./pages/${hash}.html`);
                    let html = await res.text();
                    
                    document.getElementById('content-area').innerHTML = html;
                    
                    const scripts = document.getElementById('content-area').getElementsByTagName('script');
                    for (let script of scripts) {
                        eval(script.innerHTML);
                    }
                    
                    lucide.createIcons();
                    
                    if (hash === 'home') {
                        renderPinnedInSide();
                        if (window.renderPinnedAlbum) {
                            setTimeout(window.renderPinnedAlbum, 50);
                        }
                    }
                    
                    renderQueue();
                } catch {
                    location.hash = '#home';
                }
            }
        }

        // ========== ГЕНЕРАЦИЯ СТРАНИЦ ВИДЕО ==========
        function generateVideosPage() {
            return `
                <div style="padding: 0; width: 100%;">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 30px;">
                        <div>
                            <h1 style="font-size: 32px; font-weight: 800; margin-bottom: 8px;">Видеоклипы</h1>
                            <p style="color: #7a7a7a; font-size: 15px;">Смотри лучшие клипы в высоком качестве</p>
                        </div>
                    </div>

                    <div id="video-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 24px;">
                        ${window.videoDatabase.map(video => `
                            <div class="video-card" onclick="location.hash='#video-${video.id}'">
                                <div class="video-thumbnail">
                                    <img src="${video.thumbnail}" class="video-thumbnail-img" loading="lazy">
                                    <div class="video-duration">${video.duration}</div>
                                    <div class="video-play-overlay">
                                        <i data-lucide="play" size="40" color="white" fill="white"></i>
                                    </div>
                                </div>
                                <div style="display:flex; gap:12px; margin-top:12px;">
                                    <img src="${video.avatar}" style="width:40px; height:40px; border-radius:50%; object-fit:cover;" loading="lazy">
                                    <div>
                                        <b style="font-size:15px;">${video.title}</b>
                                        <br>
                                        <small style="color:#7a7a7a;">${video.artist}</small>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function generateVideoPage(video) {
            return `
                <div id="video-player-section" style="padding: 0; width: 100%;">
                    <div style="margin-bottom: 30px;">
                        <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 20px;">
                            <div class="p-btn" style="width: 45px; height: 45px; background: #1a1a1a;" onclick="location.hash='#videos'">
                                <i data-lucide="arrow-left" size="20" color="white"></i>
                            </div>
                            <div>
                                <h1 style="font-size: 28px; font-weight: 800; margin-bottom: 4px;">${video.title}</h1>
                                <p style="color: #7a7a7a; font-size: 16px;">${video.artist}</p>
                            </div>
                        </div>
                        
                        <div style="width: 100%; margin-bottom: 30px;">
                            <div class="kinescope-player">
                                <iframe 
                                    id="video-iframe-${video.id}"
                                    src="${video.embedUrl}" 
                                    allow="autoplay; fullscreen; picture-in-picture; encrypted-media;" 
                                    frameborder="0" 
                                    allowfullscreen
                                ></iframe>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ========== УПРАВЛЕНИЕ ВИДЕО ==========
        window.togglePlay = function() {
            if (window.location.hash.includes('video-') && window.currentVideoIframe) {
                const btn = document.getElementById('main-play-btn');
                const isPlaying = btn.getAttribute('data-lucide') === 'pause';
                
                try {
                    window.currentVideoIframe.contentWindow.postMessage({
                        event: 'command',
                        func: isPlaying ? 'pauseVideo' : 'playVideo',
                        args: ''
                    }, '*');
                } catch(e) {
                    console.log('Не удалось отправить команду плееру');
                }
                
                btn.setAttribute('data-lucide', isPlaying ? 'play' : 'pause');
                window.isVideoPlaying = !isPlaying;
                lucide.createIcons();
            } else {
                if (!audio.src) return;
                if (audio.paused) {
                    audio.play();
                } else {
                    audio.pause();
                }
                if (window.currentTracks[window.currentIdx]) {
                    updateUI(window.currentTracks[window.currentIdx]);
                }
            }
        };

        window.nextTrack = function() {
            if (window.location.hash.includes('video-') && window.currentVideoId) {
                const index = window.videoDatabase.findIndex(v => v.id === window.currentVideoId);
                if (index < window.videoDatabase.length - 1) {
                    location.hash = `#video-${window.videoDatabase[index + 1].id}`;
                }
            } else {
                if (window.currentIdx < window.currentTracks.length - 1) {
                    window.playTrack(window.currentIdx + 1, window.currentTracks);
                }
            }
        };

        window.prevTrack = function() {
            if (window.location.hash.includes('video-') && window.currentVideoId) {
                const index = window.videoDatabase.findIndex(v => v.id === window.currentVideoId);
                if (index > 0) {
                    location.hash = `#video-${window.videoDatabase[index - 1].id}`;
                }
            } else {
                if (window.currentIdx > 0) {
                    window.playTrack(window.currentIdx - 1, window.currentTracks);
                }
            }
        };

        // ========== ПЛЕЙ АЛЬБОМА ==========
        window.playAlbum = function(album) {
            if (album === 'mayhem') {
                location.hash = '#mayhem';
                setTimeout(() => {
                    window.playTrack(0, window.albumTracks);
                }, 100);
            } else if (album === 'red') {
                location.hash = '#red';
                setTimeout(() => {
                    window.playTrack(0, window.redTracks);
                }, 100);
            }
        };

        // ========== ОБНОВЛЕНИЕ ПРАВОЙ ПАНЕЛИ ==========
        function updateRightPanelForVideos(currentVideo = null) {
            const sidePanel = document.querySelector('.panel.side:last-child');
            if (!sidePanel) return;
            
            const titleEl = sidePanel.querySelector('h2');
            if (titleEl) {
                titleEl.innerText = 'Смотрите так же';
                titleEl.style.fontSize = '24px';
                titleEl.style.fontWeight = '800';
            }
            
            const artistEl = document.getElementById('side-artist');
            if (artistEl) artistEl.style.display = 'none';
            
            const coverEl = document.getElementById('side-cover');
            if (coverEl) coverEl.style.display = 'none';
            
            const likeBtn = document.getElementById('like-side');
            if (likeBtn) likeBtn.style.display = 'none';
            
            let recommendations = [...window.videoDatabase];
            if (currentVideo) {
                recommendations = recommendations.filter(v => v.id !== currentVideo.id);
            }
            
            const shuffled = [...recommendations].sort(() => Math.random() - 0.5).slice(0, 8);
            
            const container = sidePanel.querySelector('div:last-child > div:last-child');
            if (container) {
                container.innerHTML = `
                    <div id="queue-list" style="overflow-y: auto; flex: 1; padding-right: 5px;">
                        ${shuffled.map(video => `
                            <div class="recommendation-item" onclick="location.hash='#video-${video.id}'">
                                <div class="recommendation-thumbnail">
                                    <img src="${video.thumbnail}" loading="lazy">
                                </div>
                                <div class="recommendation-info">
                                    <span style="font-size:14px; font-weight:600; display:block; margin-bottom:4px;">${video.title}</span>
                                    <span style="font-size:12px; color:#7a7a7a;">${video.artist}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
        }

        // ========== АУДИО ПЛЕЕР ==========
        window.playTrack = function(idx, trackList) {
            if (!trackList?.length) return;
            window.currentTracks = trackList;
            window.currentIdx = idx;
            const track = window.currentTracks[window.currentIdx];
            window.audio.src = track.url;
            window.audio.play();
            updateUI(track);
            renderQueue();
            
            setTimeout(() => {
                if (location.hash === '#mayhem' && window.renderMayhemTracks) {
                    window.renderMayhemTracks();
                    window.updateAlbumPlayButton?.();
                }
                if (location.hash === '#red' && window.renderRedTracks) {
                    window.renderRedTracks();
                    window.updateAlbumPlayButton?.();
                }
            }, 50);
        };

        function updateUI(track) {
            document.getElementById('p-title').innerText = track.title;
            document.getElementById('p-artist').innerText = track.artist || 'Lady Gaga';
            
            let cover = albumCover;
            if (window.currentTracks === window.redTracks) {
                cover = redCover;
                document.getElementById('p-artist').innerText = 'Taylor Swift';
            }
            
            document.getElementById('p-img').src = cover;
            document.getElementById('p-img').style.display = 'block';
            
            document.getElementById('side-cover').src = cover;
            document.getElementById('side-cover').style.display = 'block';
            document.getElementById('side-title').innerText = track.title;
            document.getElementById('side-artist').innerText = document.getElementById('p-artist').innerText;
            
            const icon = audio.paused ? 'play' : 'pause';
            document.getElementById('main-play-btn').setAttribute('data-lucide', icon);
            
            isLiked = false;
            document.querySelectorAll('.like-btn').forEach(el => {
                el.classList.remove('active');
                el.setAttribute('fill', 'none');
                el.setAttribute('color', '#b3b3b3');
            });
            
            lucide.createIcons();
        }

        // ========== ОЧЕРЕДЬ ==========
        function renderQueue() {
            const queueList = document.getElementById('queue-list');
            if (!queueList) return;
            
            if (window.location.hash.includes('video-') || window.location.hash === '#videos') {
                return;
            }
            
            if (!window.currentTracks || !window.currentTracks.length) {
                queueList.innerHTML = '<p style="color:#7a7a7a; padding:10px;">Очередь пуста</p>';
                return;
            }
            
            const queueTracks = window.currentTracks.slice(window.currentIdx);
            let cover = albumCover;
            let artist = 'Lady Gaga';
            
            if (window.currentTracks === window.redTracks) {
                cover = redCover;
                artist = 'Taylor Swift';
            }
            
            queueList.innerHTML = queueTracks.map((t, i) => {
                const isPlaying = i === 0;
                return `
                    <div class="queue-item ${isPlaying ? 'playing' : ''}" onclick="window.playTrack(${window.currentIdx + i}, window.currentTracks)">
                        <img src="${cover}" style="width:44px; height:44px; border-radius:4px;">
                        <div style="flex:1;">
                            <b style="font-size:13px; ${isPlaying ? 'color: #CC6B26;' : ''}">${t.title}</b>
                            <br><small style="color:#7a7a7a;">${artist}</small>
                        </div>
                        <span style="color:#7a7a7a; font-size:12px;">${t.time}</span>
                    </div>
                `;
            }).join('');
        }

        // ========== ВРЕМЯ ==========
        audio.ontimeupdate = function() {
            if (audio.duration && !window.location.hash.includes('video-')) {
                const pct = (audio.currentTime / audio.duration) * 100 || 0;
                document.getElementById('p-fill').style.width = pct + '%';
                document.getElementById('c-time').innerText = formatTime(audio.currentTime);
                document.getElementById('d-time').innerText = formatTime(audio.duration);
            }
        };

        function formatTime(s) {
            if (!s) return '0:00';
            const m = Math.floor(s / 60);
            const sec = Math.floor(s % 60);
            return `${m}:${sec < 10 ? '0' : ''}${sec}`;
        }

        window.seek = function(e) {
            if (window.location.hash.includes('video-')) {
                return;
            } else if (audio.duration) {
                const rect = e.currentTarget.getBoundingClientRect();
                audio.currentTime = ((e.clientX - rect.left) / rect.width) * audio.duration;
            }
        };

        // ========== ГРОМКОСТЬ ==========
        window.startVolDrag = function(e) {
            isVolDragging = true;
            updateVolumeFromEvent(e);
        };

        function updateVolumeFromEvent(e) {
            const rect = document.getElementById('vol-slider').getBoundingClientRect();
            let pct = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));
            audio.volume = pct;
            document.getElementById('v-fill').style.width = (pct * 100) + '%';
        }

        window.handleVolumeWheel = function(e) {
            e.preventDefault();
            audio.volume = Math.max(0, Math.min(1, audio.volume + (e.deltaY < 0 ? 0.05 : -0.05)));
            document.getElementById('v-fill').style.width = (audio.volume * 100) + '%';
        };

        window.addEventListener('mousemove', (e) => { if (isVolDragging) updateVolumeFromEvent(e); });
        window.addEventListener('mouseup', () => { isVolDragging = false; });

        // ========== ЛАЙК ==========
        window.toggleLike = function() {
            if (!window.currentTracks.length && !window.currentVideoId) return;
            
            if (window.location.hash.includes('video-') && window.currentVideoId) {
                window.videoLikes[window.currentVideoId] = !window.videoLikes[window.currentVideoId];
                const isLiked = window.videoLikes[window.currentVideoId];
                document.querySelectorAll('.like-btn').forEach(el => {
                    el.classList.toggle('active', isLiked);
                    el.setAttribute('fill', isLiked ? '#CC6B26' : 'none');
                    el.setAttribute('color', isLiked ? '#CC6B26' : '#b3b3b3');
                });
            } else {
                isLiked = !isLiked;
                document.querySelectorAll('.like-btn').forEach(el => {
                    el.classList.toggle('active', isLiked);
                    el.setAttribute('fill', isLiked ? '#CC6B26' : 'none');
                    el.setAttribute('color', isLiked ? '#CC6B26' : '#b3b3b3');
                });
            }
            lucide.createIcons();
        };

        // ========== ЛЕВАЯ ПАНЕЛЬ ==========
        window.filterSide = function(type, el) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
            renderSide(type);
        };

        function renderSide(filter) {
            const data = [
                { name: "Lady Gaga", sub: "Исполнитель", type: "artist" },
                { name: "Taylor Swift", sub: "Исполнитель", type: "artist" },
                { name: "Mayhem", sub: "Альбом • 2025", type: "album", hash: "mayhem", cover: albumCover },
                { name: "Red (Taylor's Version)", sub: "Альбом • 2021", type: "album", hash: "red", cover: redCover }
            ];
            
            document.getElementById('filtered-content').innerHTML = data
                .filter(item => filter === 'all' || item.type === filter)
                .map(item => `
                    <div class="side-item" onclick="location.hash='#${item.type === 'album' ? item.hash : ''}'">
                        <img src="${item.cover || albumCover}" style="width:52px; height:52px; border-radius:4px;">
                        <div><b>${item.name}</b><br><small style="color:#7a7a7a;">${item.sub}</small></div>
                    </div>
                `).join('');
            
            renderPinnedInSide();
        }

        // ========== ЗАКРЕПЛЕННЫЙ АЛЬБОМ ==========
        function renderPinnedInSide() {
            const container = document.getElementById('pinned-side-container');
            if (!container) return;
            
            if (window.pinnedAlbum) {
                container.innerHTML = `
                    <h3 style="font-size:14px; font-weight:700; margin:20px 0 15px; color:#7a7a7a; text-transform:uppercase;">Закреплено</h3>
                    <div class="side-item" onclick="location.hash='#${window.pinnedAlbum.hash || 'mayhem'}'">
                        <img src="${window.pinnedAlbum.cover}" style="width:52px; height:52px; border-radius:4px;">
                        <div><b>${window.pinnedAlbum.name}</b><br><small style="color:#7a7a7a;">${window.pinnedAlbum.sub}</small></div>
                    </div>
                `;
            } else {
                container.innerHTML = '';
            }
        }

        window.renderPinnedInSide = renderPinnedInSide;

        // ========== ОБРАБОТЧИК КОНЦА ТРЕКА ==========
        audio.onended = function() {
            if (window.currentIdx < window.currentTracks.length - 1) {
                window.playTrack(window.currentIdx + 1, window.currentTracks);
            }
            renderQueue();
            
            setTimeout(() => {
                if (location.hash === '#mayhem' && window.renderMayhemTracks) {
                    window.renderMayhemTracks();
                    window.updateAlbumPlayButton?.();
                }
                if (location.hash === '#red' && window.renderRedTracks) {
                    window.renderRedTracks();
                    window.updateAlbumPlayButton?.();
                }
            }, 100);
        };

        // ========== СТАРТ ==========
        window.addEventListener('hashchange', loadContent);
        
        auth.onAuthStateChanged(function(user) {
            updateAuthUI(user);
        });
        
        window.onload = () => {
            loadContent();
            renderSide('all');
            lucide.createIcons();
            audio.volume = 0.7;
            
            const hash = location.hash.replace('#', '') || 'home';
            if (hash === 'videos' || hash.startsWith('video-')) {
                document.querySelector('.music-nav-btn')?.classList.remove('active');
                document.querySelector('.video-nav-btn')?.classList.add('active');
            } else {
                document.querySelector('.music-nav-btn')?.classList.add('active');
                document.querySelector('.video-nav-btn')?.classList.remove('active');
            }
        };
    </script>
</body>
</html>
