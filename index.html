<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Deynik Music</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
    <header class="top-nav">
        <div class="logo-area" onclick="location.hash='#home'">
            <h1>Deynik Music</h1>
            <svg width="32" height="32" viewBox="0 0 100 100">
                <polygon points="5,10 75,50 5,90" fill="#5c4033"/>
                <path d="M70,30 Q95,50 70,70 M85,15 Q120,50 85,85" stroke="#5c4033" fill="none" stroke-width="8" stroke-linecap="round"/>
            </svg>
        </div>
        <div class="search-container">
            <input type="text" class="search-input" placeholder="Поиск музыки">
        </div>
        <div style="width: 380px;"></div>
    </header>

    <div class="app-main">
        <aside class="panel side">
            <div class="side-header">
                <i data-lucide="library"></i> <b>Моя медиатека</b>
            </div>
            <div class="side-item active" onclick="location.hash='#home'">
                <i data-lucide="home"></i> <span>Главная</span>
            </div>
            <div id="side-list-content">
                <div class="side-item-playlist">
                    <div class="playlist-icon-likes"><i data-lucide="heart" fill="white"></i></div>
                    <div><b>Лайки</b><br><small>Плейлист • 17 треков</small></div>
                </div>
            </div>
        </aside>

        <main class="panel center scroll-hide" id="content-area"></main>

        <aside class="panel side">
            <div class="right-tabs">
                <div id="t-queue" class="tab-link active" onclick="switchRight('queue')">Далее</div>
                <div id="t-wiki" class="tab-link" onclick="switchRight('wiki')">О треке</div>
            </div>
            <div class="right-content-scroll scroll-hide">
                <img id="side-cover" src="https://s3.k-connect.ru/static/music/1475/5955/1770656744_cover.jpeg" class="side-big-cover">
                
                <div id="panel-queue">
                    <p class="section-label">В ЭТОМ АЛЬБОМЕ</p>
                    <div id="queue-list"></div>
                </div>

                <div id="panel-wiki" class="hidden">
                    <h2 id="wiki-title" style="margin-top:15px;"></h2>
                    <p id="wiki-text" class="wiki-description"></p>
                </div>
            </div>
        </aside>
    </div>

    <footer class="player-bar">
        <div class="p-info">
            <img id="p-img" src="" class="p-cover-img" style="display:none;">
            <div>
                <b id="p-title">Выберите трек</b>
                <span id="p-artist">Lady Gaga</span>
            </div>
            <i data-lucide="heart" class="like-btn" style="margin-left:15px;"></i>
        </div>

        <div class="p-controls-wrapper">
            <div class="p-buttons">
                <i data-lucide="shuffle" size="18" class="p-icon-btn"></i>
                <i data-lucide="skip-back" fill="currentColor" size="24" class="p-icon-btn" onclick="prevTrack()"></i>
                <div class="p-play-circle" onclick="togglePlay()">
                    <i id="main-play-icon" data-lucide="play" fill="black" size="22"></i>
                </div>
                <i data-lucide="skip-forward" fill="currentColor" size="24" class="p-icon-btn" onclick="nextTrack()"></i>
                <i data-lucide="repeat" size="18" class="p-icon-btn"></i>
            </div>
            <div class="p-progress-area">
                <span id="c-time">0:00</span>
                <div class="p-bar-bg" onclick="seek(event)"><div id="p-fill" class="p-bar-fill"></div></div>
                <span id="d-time">0:00</span>
            </div>
        </div>

        <div class="p-volume-area">
            <i data-lucide="volume-2" size="20" color="#b3b3b3"></i>
            <div class="vol-slider"><div class="vol-fill" style="width:70%;"></div></div>
        </div>
    </footer>

    <script>
        let audio = new Audio();
        let currentTracks = [];
        let currentIdx = -1;

        async function loadContent() {
            let hash = location.hash.replace('#', '') || 'home';
            try {
                const res = await fetch(`./pages/${hash}.html`);
                document.getElementById('content-area').innerHTML = await res.text();
                lucide.createIcons();
            } catch { location.hash = '#home'; }
        }

        window.playTrack = function(idx, list) {
            currentTracks = list;
            currentIdx = idx;
            const t = currentTracks[currentIdx];
            audio.src = t.url;
            audio.play();
            updateUI(t);
            renderQueue();
            updateWiki(t);
            if(window.highlightCurrent) window.highlightCurrent(idx);
        };

        function updateUI(t) {
            document.getElementById('p-title').innerText = t.title;
            document.getElementById('p-img').src = "https://s3.k-connect.ru/static/music/1475/5955/1770656744_cover.jpeg";
            document.getElementById('p-img').style.display = 'block';
            document.getElementById('main-play-icon').setAttribute('data-lucide', audio.paused ? 'play' : 'pause');
            lucide.createIcons();
        }

        function togglePlay() {
            if(!audio.src) return;
            audio.paused ? audio.play() : audio.pause();
            updateUI(currentTracks[currentIdx]);
        }

        function nextTrack() { if(currentIdx < currentTracks.length-1) playTrack(currentIdx+1, currentTracks); }
        function prevTrack() { if(currentIdx > 0) playTrack(currentIdx-1, currentTracks); }

        function renderQueue() {
            document.getElementById('queue-list').innerHTML = currentTracks.map((t, i) => `
                <div class="side-queue-item ${i === currentIdx ? 'active' : ''}" onclick="playTrack(${i}, currentTracks)">
                    <img src="https://s3.k-connect.ru/static/music/1475/5955/1770656744_cover.jpeg">
                    <div><b>${t.title}</b><br><small>Lady Gaga</small></div>
                </div>
            `).join('');
        }

        function updateWiki(t) {
            document.getElementById('wiki-title').innerText = t.title;
            // Краткая генерация инфо
            const desc = `Трек "${t.title}" — это глубокое погружение в эстетику альбома Mayhem. Lady Gaga сочетает здесь экспериментальный поп и мощные биты. Длительность композиции составляет ${t.time || '3:50'}.`;
            document.getElementById('wiki-text').innerText = desc;
        }

        function switchRight(type) {
            document.getElementById('panel-queue').classList.toggle('hidden', type !== 'queue');
            document.getElementById('panel-wiki').classList.toggle('hidden', type !== 'wiki');
            document.getElementById('t-queue').classList.toggle('active', type === 'queue');
            document.getElementById('t-wiki').classList.toggle('active', type === 'wiki');
        }

        audio.ontimeupdate = () => {
            const pct = (audio.currentTime / audio.duration) * 100 || 0;
            document.getElementById('p-fill').style.width = pct + '%';
            document.getElementById('c-time').innerText = formatTime(audio.currentTime);
            if(audio.duration) document.getElementById('d-time').innerText = formatTime(audio.duration);
        };

        function formatTime(s) {
            const m = Math.floor(s/60); const sec = Math.floor(s%60);
            return `${m}:${sec < 10 ? '0' : ''}${sec}`;
        }

        function seek(e) {
            const rect = e.currentTarget.getBoundingClientRect();
            audio.currentTime = ((e.clientX - rect.left) / rect.width) * audio.duration;
        }

        window.addEventListener('hashchange', loadContent);
        window.onload = loadContent;
    </script>
</body>
</html>
