<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Deynik Music</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
    <!-- ШАПКА -->
    <header class="header">
        <div class="logo" onclick="location.hash='#home'">
            <h1>Deynik Music</h1>
        </div>
        <div class="search">
            <input type="text" placeholder="Поиск">
        </div>
        <div class="header-right"></div>
    </header>

    <!-- ОСНОВНОЙ БЛОК -->
    <div class="main">
        <!-- ЛЕВАЯ ПАНЕЛЬ -->
        <aside class="sidebar-left">
            <div class="menu-item active">
                <i data-lucide="home"></i>
                <span>Главная</span>
            </div>
            <div class="menu-item">
                <i data-lucide="library"></i>
                <span>Моя медиатека</span>
            </div>
        </aside>

        <!-- ЦЕНТР (КОНТЕНТ) -->
        <main class="content" id="content-area"></main>

        <!-- ПРАВАЯ ПАНЕЛЬ (ПОТОМ) -->
        <aside class="sidebar-right">
            <div class="right-header">
                <span class="active">Далее</span>
                <span>О треке</span>
            </div>
            <div id="queue-list"></div>
        </aside>
    </div>

    <!-- ПЛЕЕР -->
    <footer class="player">
        <div class="player-left">
            <img id="player-cover" src="" style="display:none; width:60px; height:60px;">
            <div id="player-info">
                <div id="player-title">Выберите трек</div>
                <div id="player-artist">Lady Gaga</div>
            </div>
        </div>
        <div class="player-center">
            <div class="player-controls">
                <div class="control-btn" onclick="prevTrack()">
                    <i data-lucide="skip-back" fill="white" size="20"></i>
                </div>
                <div class="control-btn play-btn" onclick="togglePlay()">
                    <i id="play-icon" data-lucide="play" fill="black" size="24"></i>
                </div>
                <div class="control-btn" onclick="nextTrack()">
                    <i data-lucide="skip-forward" fill="white" size="20"></i>
                </div>
            </div>
            <div class="progress">
                <span id="current-time">0:00</span>
                <div class="progress-bar" onclick="seek(event)">
                    <div id="progress-fill" class="progress-fill"></div>
                </div>
                <span id="duration-time">0:00</span>
            </div>
        </div>
        <div class="player-right">
            <i data-lucide="volume-2" size="20"></i>
            <div class="volume-bar" onclick="setVolume(event)">
                <div id="volume-fill" style="width:70%;"></div>
            </div>
        </div>
    </footer>

    <script>
        // Плеер
        let audio = new Audio();
        let currentTracks = [];
        let currentIndex = -1;

        // Загрузка страниц
        async function loadContent() {
            let page = location.hash.replace('#', '') || 'home';
            try {
                const res = await fetch(`./pages/${page}.html`);
                document.getElementById('content-area').innerHTML = await res.text();
            } catch {
                location.hash = '#home';
            }
            lucide.createIcons();
        }

        // Глобальные функции
        window.playTrack = function(index, tracks) {
            if (!tracks || !tracks.length) return;
            currentTracks = tracks;
            currentIndex = index;
            audio.src = tracks[index].url;
            audio.play();
            updateUI(tracks[index]);
        };

        function updateUI(track) {
            document.getElementById('player-title').innerText = track.title;
            document.getElementById('player-artist').innerText = 'Lady Gaga';
            document.getElementById('player-cover').src = 'https://s3.k-connect.ru/static/music/1475/5955/1770656744_cover.jpeg';
            document.getElementById('player-cover').style.display = 'block';
            document.getElementById('play-icon').setAttribute('data-lucide', 'pause');
            lucide.createIcons();
        }

        window.togglePlay = function() {
            if (!audio.src) return;
            audio.paused ? audio.play() : audio.pause();
            const icon = audio.paused ? 'play' : 'pause';
            document.getElementById('play-icon').setAttribute('data-lucide', icon);
            lucide.createIcons();
        };

        window.nextTrack = function() {
            if (currentIndex < currentTracks.length - 1) {
                window.playTrack(currentIndex + 1, currentTracks);
            }
        };

        window.prevTrack = function() {
            if (currentIndex > 0) {
                window.playTrack(currentIndex - 1, currentTracks);
            }
        };

        // Время
        audio.ontimeupdate = function() {
            if (audio.duration) {
                const pct = (audio.currentTime / audio.duration) * 100;
                document.getElementById('progress-fill').style.width = pct + '%';
                document.getElementById('current-time').innerText = formatTime(audio.currentTime);
                document.getElementById('duration-time').innerText = formatTime(audio.duration);
            }
        };

        function formatTime(s) {
            const m = Math.floor(s / 60);
            const sec = Math.floor(s % 60);
            return m + ':' + (sec < 10 ? '0' : '') + sec;
        }

        window.seek = function(e) {
            const rect = e.currentTarget.getBoundingClientRect();
            audio.currentTime = ((e.clientX - rect.left) / rect.width) * audio.duration;
        };

        window.setVolume = function(e) {
            const rect = e.currentTarget.getBoundingClientRect();
            const vol = (e.clientX - rect.left) / rect.width;
            audio.volume = Math.max(0, Math.min(1, vol));
            document.getElementById('volume-fill').style.width = (audio.volume * 100) + '%';
        };

        audio.onended = window.nextTrack;
        audio.volume = 0.7;
        window.addEventListener('hashchange', loadContent);
        window.onload = loadContent;
    </script>
</body>
</html>
